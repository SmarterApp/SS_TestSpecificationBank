/*******************************************************************************
 * Educational Online Test Delivery System
 * Copyright (c) 2013 American Institutes for Research
 * 
 * Distributed under the AIR Open Source License, Version 1.0
 * See accompanying file AIR-License-1_0.txt or at
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 ******************************************************************************/
package org.opentestsystem.authoring.testspecbank.service.impl;

import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.integration.sftp.session.DefaultSftpSessionFactory;
import org.springframework.stereotype.Service;

@Service("testItemBankFileTransferService")
public class TestItemBankFileTransferServiceImpl extends AbstractSftpFileTransferService {

    @Autowired
    private DefaultSftpSessionFactory testItemBankSftpSessionFactory;

    @Value("${tsb.tib.sftp.dir:}")
    private String sftpDir;

    @Value(value = "${tsb.tib.sftp.host:}")
    private String sftpHost;

    @Value(value = "${tsb.tib.sftp.port:22}")
    private int sftpPort;

    @Value(value = "${tsb.tib.sftp.user:}")
    private String sftpUser;

    @Override
    protected DefaultSftpSessionFactory getSftpSessionFactory() {
        return testItemBankSftpSessionFactory;
    }

    @Override
    protected String getHumanReadableConnectionInfo(final String fileName) {
        return "sftp://" + sftpUser + "@" + sftpHost + ":" + sftpPort + "/" + getFullPath(fileName);
    }

    @Override
    protected String getFullPath(final String fileName) {
        return (StringUtils.isBlank(sftpDir)) ? fileName : sftpDir + "/" + fileName;
    }
}
